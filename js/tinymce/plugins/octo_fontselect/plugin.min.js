tinymce.PluginManager.add("octo_fontselect",function(t,o){t.addButton("octo_fontselect",function(){function o(o,n){return function(e){var a=this;$wpButton=jQuery("#"+e.control._id),$button=$wpButton.find("button"),$button.addClass("octButton").addClass("octInputList").addClass("octFontList"),$button.click(function(){var t=$button.find("input.find");t.size()||(t=jQuery('<input type="text" class="find">'),t.css("width","70px"),t.attr("placeholder",$button.find("span").text()),t.keyup(function(){var o=jQuery.trim(t.val()),n=jQuery(e.control.rootControl._octFontSelectBody).find(".mce-menu-item");n.show(),o.length&&(o=o.toUpperCase(),n.each(function(){var t=jQuery(this).find(".mce-text span").text().toUpperCase();0!=t.indexOf(o)&&jQuery(this).hide()}))}),$button.append(t)),$button.parent(".mce-btn").hasClass("mce-active")?t.remove():t.focus()}),t.on("nodeChange",function(e){var c=t.formatter,i=null;tinymce.util.Tools.each(e.parents,function(t){return tinymce.util.Tools.each(o,function(o){return n?c.matchNode(t,n,{value:o.value})&&(i=o.value):c.matchNode(t,o.value)&&(i=o.value),i?!1:void 0}),i?!1:void 0}),a.value(i),i&&a.text(i),g_octCanvas.loadFonts(g_octCanvas.scanAllFonts())})}}var n=octOcto.fonts.standard.concat(octOcto.fonts.google),e="Font Name",a=[];for(var c in n)a.push({text:n[c],value:n[c],classes:"not-inline"});return{type:"listbox",text:e,tooltip:"Font Family",values:a,onPostRender:o(a,"fontname"),onshow:function(t){if(!t.control._octChangedElements){t.control._octChangedElements=!0;var o=t.control.getEl("body"),n=100;t.control.rootControl._octFontSelectBody=o,jQuery(o).find(".mce-menu-item.mce-stack-layout-item").each(function(){var t=jQuery(this).find("span:first"),o=(t.css("font-family"),t.text());t.css("font-family",""),t.html('<span class="mce-menu-item-left">'+o+'</span><div style="clear: both;"></div>'),t.addClass("mce-menu-item-block")}),jQuery(o).css({"max-height":"100px"}).slimScroll({height:n+"px",distance:"15px",size:"3px",borderRadius:"3px",railBorderRadius:"3px",color:"#fff",opacity:1,railColor:"#fff",railOpacity:.5,railVisible:!0,alwaysVisible:!0,allowPageScroll:!1}),t.control._octSlimScrollH=n+10}},onhide:function(t){var o=jQuery("#"+t.control._parent._id);jQuery("#"+t.control._parent.rootControl._id);o.find("input.find").remove(),jQuery(t.control.rootControl._octFontSelectBody).find(".mce-menu-item").show()},onselect:function(o){if(o.control.text("Ab"),o.control.settings.value){o.control.text(o.control.settings.value),t.theme.panel._octNewSubMenuMoved=!0,t.execCommand("FontName",!1,o.control.settings.value);var n=[],e=function(t){return t=jQuery.trim(t),("'"==t.charAt(0)||'"'==t.charAt(0))&&(t=t.substr(1)),("'"==t.charAt(t.length-1)||'"'==t.charAt(t.length-1))&&(t=t.substr(0,t.length-1)),t},a=jQuery(t.bodyElement);a.find("*").each(function(){var t=jQuery(this),o=t.css("font-family");if(-1!=o.indexOf(",")){var o=o.split(",");for(var a in o)n.push(e(o[a]))}else n.push(e(o))}),n=n.filter(function(t,o,n){return n.indexOf(t)==o}),a.attr("data-octfonts",n)}}}})});